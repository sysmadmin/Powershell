$INBOX = ""
$KEYWORDTYPE = ""
$KEYWORD = ""
$SCRIPT = ""
$NAME = ""
$CONFIRMATION = ""

do {
        do {
            $INBOX = Read-Host "One inbox or all inboxes? ALL/ONE"
            }
        while ( ($INBOX -ne "ALL") -and ($INBOX -ne "ONE") )

        do {
            $KEYWORDTYPE = Read-Host "What type of keyword will you be searching by? CONTENT/SUBJECT/SENDER"
          }
        while ( ($KEYWORDTYPE -ne "CONTENT") -and ($KEYWORDTYPE -ne "SUBJECT") -and ($KEYWORDTYPE -ne "SENDER") )
        #Converting to caps (appearance improvement only), adding the required 'keywords'
        $KEYWORDTYPE = $KEYWORDTYPE.ToUpper() + "KEYWORDS"

        $KEYWORD = Read-Host "What is the keyword you will be searching for?"
        
        if ($INBOX -eq "ONE")
        {
            $NAME = Read-Host "What user account will be searched?"
            $SCRIPT = "Export-Mailbox -Identity DOMAIN\$NAME -TargetMailbox TARGETMAILBOX -TargetFolder TARGETFOLDER -$KEYWORDTYPE '$KEYWORD' -DeleteContent -Confirm:`$false -baditemlimit 10000 –IncludeFolders '\Inbox'"
            Write-Host $SCRIPT
            $CONFIRMATION = Read-Host "Does this look correct? YES/NO"
        }
        elseif ($INBOX -eq "ALL")
        {
            $SCRIPT = "Get-Mailbox -Database 'EXCHANGESERVER\STORAGEGROUP\Mailbox Database' | Export-Mailbox -TargetMailbox TARGETMAILBOX -TargetFolder TARGETFOLDER -$KEYWORDTYPE '$KEYWORD' -DeleteContent -Confirm:`$false -BadItemLimit 10000 –IncludeFolders '\Inbox'"
            Write-Host $SCRIPT
            $CONFIRMATION = Read-Host "Does this look correct? YES/NO"
        }
        #Verify the response is valid without restarting the whole process
        while (($CONFIRMATION -ne "YES") -and ($CONFIRMATION -ne "Y") -and ($CONFIRMATION -ne "NO") -and ($CONFIRMATION -ne "N")) 
        {
            $CONFIRMATION = Read-Host "$CONFIRMATION is not a recognized response. Please enter Y or YES to run the command, or enter N or NO to start over"
        }
    }
#If the response is valid (Y/YES/N/NO), but is not Y or YES, then 'do' runs again
while ( ($CONFIRMATION -ne "YES") -and ($CONFIRMATION -ne "Y"))
#Run the actual command to remove the email
Invoke-Expression $SCRIPT
